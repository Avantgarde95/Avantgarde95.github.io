<!DOCTYPE html><html lang="ko" class="m-0 h-full w-full p-0 font-sans"><head><meta charSet="utf-8"/><meta name="viewport" content="width=device-width, initial-scale=1"/><link rel="stylesheet" href="/_next/static/css/c709d57c9a965b1c.css" data-precedence="next"/><link rel="preload" as="script" fetchPriority="low" href="/_next/static/chunks/webpack-5f8259d795d78687.js"/><script src="/_next/static/chunks/0eb9b0f6-835f6871f50648cc.js" async=""></script><script src="/_next/static/chunks/417-bb771389cd61a9c0.js" async=""></script><script src="/_next/static/chunks/main-app-5076d6c7690900cf.js" async=""></script><script src="/_next/static/chunks/app/layout-5d369154124a380d.js" async=""></script><script src="/_next/static/chunks/66a21e36-9320fd4f2767de8c.js" async=""></script><script src="/_next/static/chunks/79-121b1482e66f2415.js" async=""></script><script src="/_next/static/chunks/568-94d199cce9c2ce6e.js" async=""></script><script src="/_next/static/chunks/app/%5Blocale%5D/blog/post/%5Bkey%5D/page-39ba752fa4b62049.js" async=""></script><link rel="preconnect" href="https://fonts.googleapis.com"/><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin=""/><title>Server &amp; client mismatch problem in Next.js</title><link rel="stylesheet" as="style" crossorigin="" href="https://cdn.jsdelivr.net/gh/orioncactus/pretendard@v1.3.9/dist/web/static/pretendard-dynamic-subset.min.css"/><link href="https://fonts.googleapis.com/css2?family=Fira+Code:wght@300..700&amp;display=swap" rel="stylesheet"/><script src="/_next/static/chunks/polyfills-42372ed130431b0a.js" noModule=""></script></head><body class="m-0 h-full w-full p-0"><style>#nprogress{pointer-events:none}#nprogress .bar{background:#d6d6d6;position:fixed;z-index:1600;top: 0;left:0;width:100%;height:3px}#nprogress .peg{display:block;position:absolute;right:0;width:100px;height:100%;;opacity:1;-webkit-transform:rotate(3deg) translate(0px,-4px);-ms-transform:rotate(3deg) translate(0px,-4px);transform:rotate(3deg) translate(0px,-4px)}#nprogress .spinner{display:block;position:fixed;z-index:1600;top: 15px;right:15px}#nprogress .spinner-icon{width:18px;height:18px;box-sizing:border-box;border:2px solid transparent;border-top-color:#d6d6d6;border-left-color:#d6d6d6;border-radius:50%;-webkit-animation:nprogress-spinner 400ms linear infinite;animation:nprogress-spinner 400ms linear infinite}.nprogress-custom-parent{overflow:hidden;position:relative}.nprogress-custom-parent #nprogress .bar,.nprogress-custom-parent #nprogress .spinner{position:absolute}@-webkit-keyframes nprogress-spinner{0%{-webkit-transform:rotate(0deg)}100%{-webkit-transform:rotate(360deg)}}@keyframes nprogress-spinner{0%{transform:rotate(0deg)}100%{transform:rotate(360deg)}}</style><div class="flex h-full w-full flex-col items-center overflow-y-auto bg-background pt-16 text-primary"><div class="w-full max-w-screen-lg px-6"><div class="w-full"><header class="mb-4 flex w-full flex-row items-center"><h1 class="m-0 mr-auto p-0 font-mono text-3xl font-normal md:text-4xl">Blog</h1><div class="relative"><button class="font-mono text-base hover:text-yellow">&lt;Menu/&gt;</button><div class="absolute right-0 z-10 origin-top-right scale-0 bg-background font-mono text-base text-primary [transition:transform_200ms,opacity_150ms] scale-0 opacity-0"><div class="px-2 py-0.5 whitespace-pre">+<!-- -->------------------<!-- -->+</div><button class="group relative block px-2 py-0.5 whitespace-pre font-mono text-base leading-tight tracking-[normal] text-primary">|                  |<span class="absolute left-7 top-1/2 -translate-y-1/2 group-hover:text-yellow">&lt;Home/&gt;</span></button><button class="group relative block px-2 py-0.5 whitespace-pre font-mono text-base leading-tight tracking-[normal] text-primary">|                  |<span class="absolute left-7 top-1/2 -translate-y-1/2 group-hover:text-yellow">&lt;Projects/&gt;</span></button><button class="group relative block px-2 py-0.5 whitespace-pre font-mono text-base leading-tight tracking-[normal] text-primary">|                  |<span class="absolute left-7 top-1/2 -translate-y-1/2 group-hover:text-yellow">&lt;Musics/&gt;</span></button><button class="group relative block px-2 py-0.5 whitespace-pre font-mono text-base leading-tight tracking-[normal] text-primary">|                  |<span class="absolute left-7 top-1/2 -translate-y-1/2 group-hover:text-yellow">&lt;Art/&gt;</span></button><button class="group relative block px-2 py-0.5 whitespace-pre font-mono text-base leading-tight tracking-[normal] text-primary">|                  |<span class="absolute left-7 top-1/2 -translate-y-1/2 group-hover:text-yellow">&lt;Blog/&gt;</span></button><div class="px-2 py-0.5 whitespace-pre">+<!-- -->------------------<!-- -->+</div><button class="group relative block px-2 py-0.5 whitespace-pre font-mono text-base leading-tight tracking-[normal] text-primary">|                  |<span class="absolute left-7 top-1/2 -translate-y-1/2 group-hover:text-yellow">English()</span></button><div class="px-2 py-0.5 whitespace-pre">+<!-- -->------------------<!-- -->+</div><button class="group relative block px-2 py-0.5 whitespace-pre font-mono text-base leading-tight tracking-[normal] text-primary">|                  |<span class="absolute left-7 top-1/2 -translate-y-1/2 group-hover:text-yellow">v1()</span></button><button class="group relative block px-2 py-0.5 whitespace-pre font-mono text-base leading-tight tracking-[normal] text-primary">|                  |<span class="absolute left-7 top-1/2 -translate-y-1/2 group-hover:text-yellow">v2()</span></button><div class="px-2 py-0.5 whitespace-pre">+<!-- -->------------------<!-- -->+</div></div></div></header><div class="mb-4 w-full border-b-2 border-dashed border-gray pb-4"><h2 class="m-0 p-0 text-xl">Server &amp; client mismatch problem in Next.js</h2><div class="text-gray">2022-09-21</div></div><div class="mb-2 break-all text-base [&amp;_a]:cursor-pointer [&amp;_a]:font-normal [&amp;_code]:font-mono [&amp;_h1]:my-4 [&amp;_h1]:text-xl [&amp;_h1]:font-bold [&amp;_h2]:my-4 [&amp;_h2]:text-lg [&amp;_h2]:font-semibold [&amp;_h3]:my-4 [&amp;_h3]:text-base [&amp;_li]:list-disc [&amp;_p]:my-4 [&amp;_pre]:my-4 [&amp;_table]:border-collapse [&amp;_table]:border-2 [&amp;_table]:border-solid [&amp;_table]:border-gray [&amp;_td]:border-2 [&amp;_td]:border-solid [&amp;_td]:border-gray [&amp;_th]:border-2 [&amp;_th]:border-solid [&amp;_th]:border-gray [&amp;_th]:p-[8px] [&amp;_ul]:pl-6"><p>이 웹사이트를 실행했을 때, 작동은 잘 되는 것 같은데 콘솔에 아래와 같은 에러 메시지들이 뜨는 문제가 있었다.</p>
<p>When I run this website, it seems to work fine, but I got following error messages appearing on the console.</p>
<pre><pre style="color:#d4d4d4;font-size:13px;text-shadow:none;font-family:Menlo, Monaco, Consolas, &quot;Andale Mono&quot;, &quot;Ubuntu Mono&quot;, &quot;Courier New&quot;, monospace;direction:ltr;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none;padding:1em;margin:.5em 0;overflow:auto;background:#1e1e1e"><code class="language-text" style="white-space:pre;color:#d4d4d4;font-size:13px;text-shadow:none;font-family:Menlo, Monaco, Consolas, &quot;Andale Mono&quot;, &quot;Ubuntu Mono&quot;, &quot;Courier New&quot;, monospace;direction:ltr;text-align:left;word-spacing:normal;word-break:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none"><span>Uncaught Error: Minified React error #425; visit https://reactjs.org/docs/error-decoder.html?invariant=425 for the full message or use the non-minified dev environment for full errors and additional helpful warnings.
</span>
<!-- -->Uncaught Error: Minified React error #418; visit https://reactjs.org/docs/error-decoder.html?invariant=418 for the full message or use the non-minified dev environment for full errors and additional helpful warnings.
<!-- -->
<!-- -->Uncaught Error: Minified React error #423; visit https://reactjs.org/docs/error-decoder.html?invariant=423 for the full message or use the non-minified dev environment for full errors and additional helpful warnings.</code></pre></pre>
<p>위 에러 메시지들에 나온 링크를 방문해보면 아래와 같은 메시지들이 나온다.</p>
<p>If you visit the links in these error messages, you will see the following messages.</p>
<ul>
<li>Text content does not match server-rendered HTML.</li>
<li>Hydration failed because the initial UI does not match what was rendered on the server.</li>
<li>There was an error while hydrating. Because the error happened outside of a Suspense boundary, the entire root will switch to client rendering.</li>
</ul>
<p>이 웹사이트는 Next.js로 정적 사이트 생성(SSG - Static Site Generation)을 하여 만들었다.
Next.js로 미리 생성한 HTML을 일단 유저에게 보여주고, 그 후에 React로 hydration &amp; CSR(Client-side Rendering)을 하는 방식이다.
따라서, 위의 메시지들은 미리 렌더링한 HTML과 클라이언트에서 렌더링한 HTML 간에 내용물이 불일치한다는 것을 의미한다.
이 문제는 SSR 뿐만 아니라 SSR 상황에서도 동일하게 발생한다.</p>
<p>I created this website by using SSG (Static Site Generation) with Next.js
It works by showing the pre-generated HTML to the user first, and performing hydration &amp; CSR (Client-side Rendering) with React.
Therefore, the above messages mean that there is a content mismatch between the pre-rendered HTML and the client-rendered HTML.
This problem can occur not only SSG but also SSR, too.</p>
<p>원인은 두 곳에 있었다.
하나는 페이지 상단의 시계 UI이다.</p>
<p>There were two reasons.
One is the clock UI at the top of the page.</p>
<pre><pre style="color:#d4d4d4;font-size:13px;text-shadow:none;font-family:Menlo, Monaco, Consolas, &quot;Andale Mono&quot;, &quot;Ubuntu Mono&quot;, &quot;Courier New&quot;, monospace;direction:ltr;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none;padding:1em;margin:.5em 0;overflow:auto;background:#1e1e1e"><code class="language-typescript" style="white-space:pre;color:#9cdcfe;font-size:13px;text-shadow:none;font-family:Menlo, Monaco, Consolas, &quot;Andale Mono&quot;, &quot;Ubuntu Mono&quot;, &quot;Courier New&quot;, monospace;direction:ltr;text-align:left;word-spacing:normal;word-break:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none"><span class="token" style="color:#569CD6">import</span><span> </span><span class="token" style="color:#d4d4d4">{</span><span> useEffect</span><span class="token" style="color:#d4d4d4">,</span><span> useState </span><span class="token" style="color:#d4d4d4">}</span><span> </span><span class="token" style="color:#569CD6">from</span><span> </span><span class="token" style="color:#ce9178">&quot;react&quot;</span><span class="token" style="color:#d4d4d4">;</span><span>
</span>
<span></span><span class="token" style="color:#569CD6">export</span><span> </span><span class="token" style="color:#569CD6">default</span><span> </span><span class="token" style="color:#569CD6">function</span><span> </span><span class="token" style="color:#dcdcaa">useNow</span><span class="token" style="color:#d4d4d4">(</span><span class="token" style="color:#d4d4d4">)</span><span> </span><span class="token" style="color:#d4d4d4">{</span><span>
</span><span>  </span><span class="token" style="color:#569CD6">const</span><span> </span><span class="token" style="color:#d4d4d4">[</span><span>now</span><span class="token" style="color:#d4d4d4">,</span><span> setNow</span><span class="token" style="color:#d4d4d4">]</span><span> </span><span class="token" style="color:#d4d4d4">=</span><span> </span><span class="token" style="color:#dcdcaa">useState</span><span class="token" style="color:#d4d4d4">(</span><span class="token" style="color:#569CD6">new</span><span> </span><span class="token" style="color:#4ec9b0">Date</span><span class="token" style="color:#d4d4d4">(</span><span class="token" style="color:#d4d4d4">)</span><span class="token" style="color:#d4d4d4">)</span><span class="token" style="color:#d4d4d4">;</span><span>
</span>
<span>  </span><span class="token" style="color:#dcdcaa">useEffect</span><span class="token" style="color:#d4d4d4">(</span><span class="token" style="color:#d4d4d4">(</span><span class="token" style="color:#d4d4d4">)</span><span> </span><span class="token" style="color:#d4d4d4">=&gt;</span><span> </span><span class="token" style="color:#d4d4d4">{</span><span>
</span><span>    </span><span class="token" style="color:#569CD6">const</span><span> interval </span><span class="token" style="color:#d4d4d4">=</span><span> </span><span class="token" style="color:#dcdcaa">setInterval</span><span class="token" style="color:#d4d4d4">(</span><span class="token" style="color:#d4d4d4">(</span><span class="token" style="color:#d4d4d4">)</span><span> </span><span class="token" style="color:#d4d4d4">=&gt;</span><span> </span><span class="token" style="color:#d4d4d4">{</span><span>
</span><span>      </span><span class="token" style="color:#dcdcaa">setNow</span><span class="token" style="color:#d4d4d4">(</span><span class="token" style="color:#569CD6">new</span><span> </span><span class="token" style="color:#4ec9b0">Date</span><span class="token" style="color:#d4d4d4">(</span><span class="token" style="color:#d4d4d4">)</span><span class="token" style="color:#d4d4d4">)</span><span class="token" style="color:#d4d4d4">;</span><span>
</span><span>    </span><span class="token" style="color:#d4d4d4">}</span><span class="token" style="color:#d4d4d4">,</span><span> </span><span class="token" style="color:#b5cea8">1000</span><span> </span><span class="token" style="color:#d4d4d4">*</span><span> </span><span class="token" style="color:#b5cea8">10</span><span class="token" style="color:#d4d4d4">)</span><span class="token" style="color:#d4d4d4">;</span><span>
</span>
<span>    </span><span class="token" style="color:#569CD6">return</span><span> </span><span class="token" style="color:#d4d4d4">(</span><span class="token" style="color:#d4d4d4">)</span><span> </span><span class="token" style="color:#d4d4d4">=&gt;</span><span> </span><span class="token" style="color:#d4d4d4">{</span><span>
</span><span>      </span><span class="token" style="color:#dcdcaa">clearInterval</span><span class="token" style="color:#d4d4d4">(</span><span>interval</span><span class="token" style="color:#d4d4d4">)</span><span class="token" style="color:#d4d4d4">;</span><span>
</span><span>    </span><span class="token" style="color:#d4d4d4">}</span><span class="token" style="color:#d4d4d4">;</span><span>
</span><span>  </span><span class="token" style="color:#d4d4d4">}</span><span class="token" style="color:#d4d4d4">,</span><span> </span><span class="token" style="color:#d4d4d4">[</span><span class="token" style="color:#d4d4d4">]</span><span class="token" style="color:#d4d4d4">)</span><span class="token" style="color:#d4d4d4">;</span><span>
</span>
<span>  </span><span class="token" style="color:#569CD6">return</span><span> </span><span class="token" style="color:#d4d4d4">{</span><span>
</span><span>    year</span><span class="token" style="color:#d4d4d4">:</span><span> now</span><span class="token" style="color:#d4d4d4">.</span><span class="token" style="color:#dcdcaa">getFullYear</span><span class="token" style="color:#d4d4d4">(</span><span class="token" style="color:#d4d4d4">)</span><span class="token" style="color:#d4d4d4">,</span><span>
</span><span>    month</span><span class="token" style="color:#d4d4d4">:</span><span> now</span><span class="token" style="color:#d4d4d4">.</span><span class="token" style="color:#dcdcaa">getMonth</span><span class="token" style="color:#d4d4d4">(</span><span class="token" style="color:#d4d4d4">)</span><span> </span><span class="token" style="color:#d4d4d4">+</span><span> </span><span class="token" style="color:#b5cea8">1</span><span class="token" style="color:#d4d4d4">,</span><span>
</span><span>    monthDay</span><span class="token" style="color:#d4d4d4">:</span><span> now</span><span class="token" style="color:#d4d4d4">.</span><span class="token" style="color:#dcdcaa">getDate</span><span class="token" style="color:#d4d4d4">(</span><span class="token" style="color:#d4d4d4">)</span><span class="token" style="color:#d4d4d4">,</span><span>
</span><span>    hour</span><span class="token" style="color:#d4d4d4">:</span><span> now</span><span class="token" style="color:#d4d4d4">.</span><span class="token" style="color:#dcdcaa">getHours</span><span class="token" style="color:#d4d4d4">(</span><span class="token" style="color:#d4d4d4">)</span><span class="token" style="color:#d4d4d4">,</span><span>
</span><span>    minute</span><span class="token" style="color:#d4d4d4">:</span><span> now</span><span class="token" style="color:#d4d4d4">.</span><span class="token" style="color:#dcdcaa">getMinutes</span><span class="token" style="color:#d4d4d4">(</span><span class="token" style="color:#d4d4d4">)</span><span class="token" style="color:#d4d4d4">,</span><span>
</span><span>    second</span><span class="token" style="color:#d4d4d4">:</span><span> now</span><span class="token" style="color:#d4d4d4">.</span><span class="token" style="color:#dcdcaa">getSeconds</span><span class="token" style="color:#d4d4d4">(</span><span class="token" style="color:#d4d4d4">)</span><span class="token" style="color:#d4d4d4">,</span><span>
</span><span>  </span><span class="token" style="color:#d4d4d4">}</span><span class="token" style="color:#d4d4d4">;</span><span>
</span><span></span><span class="token" style="color:#d4d4d4">}</span></code></pre></pre>
<p>시계 기능을 구현하기 위해 위와 같은 custom hook을 작성했었다.
그런데 <code class="bg-gray bg-opacity-20 pl-[2px] pr-[2px] align-middle text-sm leading-none undefined">const [now, setNow] = useState(new Date());</code>에서 <code class="bg-gray bg-opacity-20 pl-[2px] pr-[2px] align-middle text-sm leading-none undefined">new Date()</code>의 값은 서버 렌더링 시와, 클라이언트 렌더링 시에 <strong>서로 다르다</strong>.
이로 인하여 시계 텍스트가 두 상황에서 불일치하여 에러가 났던 것이다.
CSR 전까지는 실제 시간을 사용하지 않고 더미 값을 쓰도록 하여 해결하였다.</p>
<p>I wrote the above custom hook to implement the clock.
However, in <code class="bg-gray bg-opacity-20 pl-[2px] pr-[2px] align-middle text-sm leading-none undefined">const [now, setNow] = useState(new Date());</code>, the value of <code class="bg-gray bg-opacity-20 pl-[2px] pr-[2px] align-middle text-sm leading-none undefined">new Date()</code> is <strong>different</strong> between server rendering and client rendering.
This inconsistency of the clock text caused the error.
I solved this problem by using a dummy value until we perform CSR.</p>
<p>다만 이러면 초반에 시간이 더미 값으로 떠서 이상해 보이는 문제가 있다.
적절한 로딩 UI를 부여하면 좀 낫지 않을까 한다.</p>
<p>However, we get a problem that the user sees a dummy value at the beginning.
We may fix that problem by using appropriate loading UI.</p>
<pre><pre style="color:#d4d4d4;font-size:13px;text-shadow:none;font-family:Menlo, Monaco, Consolas, &quot;Andale Mono&quot;, &quot;Ubuntu Mono&quot;, &quot;Courier New&quot;, monospace;direction:ltr;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none;padding:1em;margin:.5em 0;overflow:auto;background:#1e1e1e"><code class="language-typescript" style="white-space:pre;color:#9cdcfe;font-size:13px;text-shadow:none;font-family:Menlo, Monaco, Consolas, &quot;Andale Mono&quot;, &quot;Ubuntu Mono&quot;, &quot;Courier New&quot;, monospace;direction:ltr;text-align:left;word-spacing:normal;word-break:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none"><span class="token" style="color:#569CD6">import</span><span> </span><span class="token" style="color:#d4d4d4">{</span><span> useEffect</span><span class="token" style="color:#d4d4d4">,</span><span> useState </span><span class="token" style="color:#d4d4d4">}</span><span> </span><span class="token" style="color:#569CD6">from</span><span> </span><span class="token" style="color:#ce9178">&quot;react&quot;</span><span class="token" style="color:#d4d4d4">;</span><span>
</span>
<span></span><span class="token" style="color:#569CD6">interface</span><span> </span><span class="token" style="color:#4ec9b0">Time</span><span> </span><span class="token" style="color:#d4d4d4">{</span><span>
</span><span>  year</span><span class="token" style="color:#d4d4d4">:</span><span> </span><span class="token" style="color:#ce9178">number</span><span class="token" style="color:#d4d4d4">;</span><span>
</span><span>  month</span><span class="token" style="color:#d4d4d4">:</span><span> </span><span class="token" style="color:#ce9178">number</span><span class="token" style="color:#d4d4d4">;</span><span>
</span><span>  monthDay</span><span class="token" style="color:#d4d4d4">:</span><span> </span><span class="token" style="color:#ce9178">number</span><span class="token" style="color:#d4d4d4">;</span><span>
</span><span>  hour</span><span class="token" style="color:#d4d4d4">:</span><span> </span><span class="token" style="color:#ce9178">number</span><span class="token" style="color:#d4d4d4">;</span><span>
</span><span>  minute</span><span class="token" style="color:#d4d4d4">:</span><span> </span><span class="token" style="color:#ce9178">number</span><span class="token" style="color:#d4d4d4">;</span><span>
</span><span>  second</span><span class="token" style="color:#d4d4d4">:</span><span> </span><span class="token" style="color:#ce9178">number</span><span class="token" style="color:#d4d4d4">;</span><span>
</span><span></span><span class="token" style="color:#d4d4d4">}</span><span>
</span>
<span></span><span class="token" style="color:#569CD6">export</span><span> </span><span class="token" style="color:#569CD6">default</span><span> </span><span class="token" style="color:#569CD6">function</span><span> </span><span class="token" style="color:#dcdcaa">useNow</span><span class="token" style="color:#d4d4d4">(</span><span class="token" style="color:#d4d4d4">)</span><span class="token" style="color:#d4d4d4">:</span><span> Time </span><span class="token" style="color:#d4d4d4">{</span><span>
</span><span>  </span><span class="token" style="color:#6a9955">// If we use new Date() at here, server HTML and client HTML won&#x27;t match.</span><span>
</span><span>  </span><span class="token" style="color:#6a9955">// So we don&#x27;t compute date before useEffect().</span><span>
</span><span>  </span><span class="token" style="color:#569CD6">const</span><span> </span><span class="token" style="color:#d4d4d4">[</span><span>now</span><span class="token" style="color:#d4d4d4">,</span><span> setNow</span><span class="token" style="color:#d4d4d4">]</span><span> </span><span class="token" style="color:#d4d4d4">=</span><span> </span><span class="token generic-function" style="color:#dcdcaa">useState</span><span class="token generic-function generic" style="color:#d4d4d4">&lt;</span><span class="token generic-function generic" style="color:#4ec9b0">Date </span><span class="token generic-function generic" style="color:#d4d4d4">|</span><span class="token generic-function generic" style="color:#4ec9b0"> </span><span class="token generic-function generic" style="color:#569CD6">null</span><span class="token generic-function generic" style="color:#d4d4d4">&gt;</span><span class="token" style="color:#d4d4d4">(</span><span class="token" style="color:#569CD6">null</span><span class="token" style="color:#d4d4d4">)</span><span class="token" style="color:#d4d4d4">;</span><span>
</span>
<span>  </span><span class="token" style="color:#dcdcaa">useEffect</span><span class="token" style="color:#d4d4d4">(</span><span class="token" style="color:#d4d4d4">(</span><span class="token" style="color:#d4d4d4">)</span><span> </span><span class="token" style="color:#d4d4d4">=&gt;</span><span> </span><span class="token" style="color:#d4d4d4">{</span><span>
</span><span>    </span><span class="token" style="color:#dcdcaa">setNow</span><span class="token" style="color:#d4d4d4">(</span><span class="token" style="color:#569CD6">new</span><span> </span><span class="token" style="color:#4ec9b0">Date</span><span class="token" style="color:#d4d4d4">(</span><span class="token" style="color:#d4d4d4">)</span><span class="token" style="color:#d4d4d4">)</span><span class="token" style="color:#d4d4d4">;</span><span>
</span>
<span>    </span><span class="token" style="color:#569CD6">const</span><span> interval </span><span class="token" style="color:#d4d4d4">=</span><span> </span><span class="token" style="color:#dcdcaa">setInterval</span><span class="token" style="color:#d4d4d4">(</span><span class="token" style="color:#d4d4d4">(</span><span class="token" style="color:#d4d4d4">)</span><span> </span><span class="token" style="color:#d4d4d4">=&gt;</span><span> </span><span class="token" style="color:#d4d4d4">{</span><span>
</span><span>      </span><span class="token" style="color:#dcdcaa">setNow</span><span class="token" style="color:#d4d4d4">(</span><span class="token" style="color:#569CD6">new</span><span> </span><span class="token" style="color:#4ec9b0">Date</span><span class="token" style="color:#d4d4d4">(</span><span class="token" style="color:#d4d4d4">)</span><span class="token" style="color:#d4d4d4">)</span><span class="token" style="color:#d4d4d4">;</span><span>
</span><span>    </span><span class="token" style="color:#d4d4d4">}</span><span class="token" style="color:#d4d4d4">,</span><span> </span><span class="token" style="color:#b5cea8">1000</span><span> </span><span class="token" style="color:#d4d4d4">*</span><span> </span><span class="token" style="color:#b5cea8">10</span><span class="token" style="color:#d4d4d4">)</span><span class="token" style="color:#d4d4d4">;</span><span>
</span>
<span>    </span><span class="token" style="color:#569CD6">return</span><span> </span><span class="token" style="color:#d4d4d4">(</span><span class="token" style="color:#d4d4d4">)</span><span> </span><span class="token" style="color:#d4d4d4">=&gt;</span><span> </span><span class="token" style="color:#d4d4d4">{</span><span>
</span><span>      </span><span class="token" style="color:#dcdcaa">clearInterval</span><span class="token" style="color:#d4d4d4">(</span><span>interval</span><span class="token" style="color:#d4d4d4">)</span><span class="token" style="color:#d4d4d4">;</span><span>
</span><span>    </span><span class="token" style="color:#d4d4d4">}</span><span class="token" style="color:#d4d4d4">;</span><span>
</span><span>  </span><span class="token" style="color:#d4d4d4">}</span><span class="token" style="color:#d4d4d4">,</span><span> </span><span class="token" style="color:#d4d4d4">[</span><span class="token" style="color:#d4d4d4">]</span><span class="token" style="color:#d4d4d4">)</span><span class="token" style="color:#d4d4d4">;</span><span>
</span>
<span>  </span><span class="token" style="color:#569CD6">return</span><span> now </span><span class="token" style="color:#d4d4d4">===</span><span> </span><span class="token" style="color:#569CD6">null</span><span>
</span><span>    </span><span class="token" style="color:#d4d4d4">?</span><span> </span><span class="token" style="color:#d4d4d4">{</span><span>
</span><span>        year</span><span class="token" style="color:#d4d4d4">:</span><span> </span><span class="token" style="color:#b5cea8">0</span><span class="token" style="color:#d4d4d4">,</span><span>
</span><span>        month</span><span class="token" style="color:#d4d4d4">:</span><span> </span><span class="token" style="color:#b5cea8">0</span><span class="token" style="color:#d4d4d4">,</span><span>
</span><span>        monthDay</span><span class="token" style="color:#d4d4d4">:</span><span> </span><span class="token" style="color:#b5cea8">0</span><span class="token" style="color:#d4d4d4">,</span><span>
</span><span>        hour</span><span class="token" style="color:#d4d4d4">:</span><span> </span><span class="token" style="color:#b5cea8">0</span><span class="token" style="color:#d4d4d4">,</span><span>
</span><span>        minute</span><span class="token" style="color:#d4d4d4">:</span><span> </span><span class="token" style="color:#b5cea8">0</span><span class="token" style="color:#d4d4d4">,</span><span>
</span><span>        second</span><span class="token" style="color:#d4d4d4">:</span><span> </span><span class="token" style="color:#b5cea8">0</span><span class="token" style="color:#d4d4d4">,</span><span>
</span><span>      </span><span class="token" style="color:#d4d4d4">}</span><span>
</span><span>    </span><span class="token" style="color:#d4d4d4">:</span><span> </span><span class="token" style="color:#d4d4d4">{</span><span>
</span><span>        year</span><span class="token" style="color:#d4d4d4">:</span><span> now</span><span class="token" style="color:#d4d4d4">.</span><span class="token" style="color:#dcdcaa">getFullYear</span><span class="token" style="color:#d4d4d4">(</span><span class="token" style="color:#d4d4d4">)</span><span class="token" style="color:#d4d4d4">,</span><span>
</span><span>        month</span><span class="token" style="color:#d4d4d4">:</span><span> now</span><span class="token" style="color:#d4d4d4">.</span><span class="token" style="color:#dcdcaa">getMonth</span><span class="token" style="color:#d4d4d4">(</span><span class="token" style="color:#d4d4d4">)</span><span> </span><span class="token" style="color:#d4d4d4">+</span><span> </span><span class="token" style="color:#b5cea8">1</span><span class="token" style="color:#d4d4d4">,</span><span>
</span><span>        monthDay</span><span class="token" style="color:#d4d4d4">:</span><span> now</span><span class="token" style="color:#d4d4d4">.</span><span class="token" style="color:#dcdcaa">getDate</span><span class="token" style="color:#d4d4d4">(</span><span class="token" style="color:#d4d4d4">)</span><span class="token" style="color:#d4d4d4">,</span><span>
</span><span>        hour</span><span class="token" style="color:#d4d4d4">:</span><span> now</span><span class="token" style="color:#d4d4d4">.</span><span class="token" style="color:#dcdcaa">getHours</span><span class="token" style="color:#d4d4d4">(</span><span class="token" style="color:#d4d4d4">)</span><span class="token" style="color:#d4d4d4">,</span><span>
</span><span>        minute</span><span class="token" style="color:#d4d4d4">:</span><span> now</span><span class="token" style="color:#d4d4d4">.</span><span class="token" style="color:#dcdcaa">getMinutes</span><span class="token" style="color:#d4d4d4">(</span><span class="token" style="color:#d4d4d4">)</span><span class="token" style="color:#d4d4d4">,</span><span>
</span><span>        second</span><span class="token" style="color:#d4d4d4">:</span><span> now</span><span class="token" style="color:#d4d4d4">.</span><span class="token" style="color:#dcdcaa">getSeconds</span><span class="token" style="color:#d4d4d4">(</span><span class="token" style="color:#d4d4d4">)</span><span class="token" style="color:#d4d4d4">,</span><span>
</span><span>      </span><span class="token" style="color:#d4d4d4">}</span><span class="token" style="color:#d4d4d4">;</span><span>
</span><span></span><span class="token" style="color:#d4d4d4">}</span></code></pre></pre>
<p>다른 하나는 이 글처럼 코드를 렌더링 할 때 쓰는 react-syntax-highlighter 라이브러리이다.
해당 라이브러리는 내부적으로 <a target="_blank" class="text-blue hover:text-yellow undefined" href="https://prismjs.com/">Prism.js<span><svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 24 24" class="mb-2 inline-block text-xs" height="1em" width="1em" xmlns="http://www.w3.org/2000/svg"><path fill="none" d="M0 0h24v24H0z"></path><path d="M6 6v2h8.59L5 17.59 6.41 19 16 9.41V18h2V6z"></path></svg></span></a>(또는 <a target="_blank" class="text-blue hover:text-yellow undefined" href="https://highlightjs.org/">highlight.js<span><svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 24 24" class="mb-2 inline-block text-xs" height="1em" width="1em" xmlns="http://www.w3.org/2000/svg"><path fill="none" d="M0 0h24v24H0z"></path><path d="M6 6v2h8.59L5 17.59 6.41 19 16 9.41V18h2V6z"></path></svg></span></a>)를 호출한다.
이들은 코드를 읽고 <strong>DOM을 변경</strong>하여 코드 하이라이팅을 한다.
이것이 mismatch를 만들어낸 것으로 추정한다.</p>
<p>이와 같은 상황에서 특정 동작을 클라이언트에서만 하도록 하고 싶으면, <code class="bg-gray bg-opacity-20 pl-[2px] pr-[2px] align-middle text-sm leading-none undefined">useEffect()</code>를 활용할 수 있다.
<code class="bg-gray bg-opacity-20 pl-[2px] pr-[2px] align-middle text-sm leading-none undefined">useEffect()</code> 안의 코드는 항상 <strong>클라이언트에서만 실행</strong>된다.
<code class="bg-gray bg-opacity-20 pl-[2px] pr-[2px] align-middle text-sm leading-none undefined">useEffect()</code>가 처음 불리는 시점은 컴포넌트가 마운트된 이후, 즉 DOM이 생성된 이후이기 때문이다.</p>
<p>The other is the react-syntax-highlighter library used when rendering code like this article.
The library calls <a target="_blank" class="text-blue hover:text-yellow undefined" href="https://prismjs.com/">Prism.js<span><svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 24 24" class="mb-2 inline-block text-xs" height="1em" width="1em" xmlns="http://www.w3.org/2000/svg"><path fill="none" d="M0 0h24v24H0z"></path><path d="M6 6v2h8.59L5 17.59 6.41 19 16 9.41V18h2V6z"></path></svg></span></a> (or <a target="_blank" class="text-blue hover:text-yellow undefined" href="https://highlightjs.org/">highlight.js<span><svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 24 24" class="mb-2 inline-block text-xs" height="1em" width="1em" xmlns="http://www.w3.org/2000/svg"><path fill="none" d="M0 0h24v24H0z"></path><path d="M6 6v2h8.59L5 17.59 6.41 19 16 9.41V18h2V6z"></path></svg></span></a>) internally.
They read the code and <strong>change the DOM</strong> to highlight the code.
It seems that that behavior created mismatches.</p>
<p>In such a situation, if you want to make certain actions executed only for the client, you can use <code class="bg-gray bg-opacity-20 pl-[2px] pr-[2px] align-middle text-sm leading-none undefined">useEffect()</code>.
Code in <code class="bg-gray bg-opacity-20 pl-[2px] pr-[2px] align-middle text-sm leading-none undefined">useEffect()</code> is always executed <strong>only on the client</strong>.
This is because the first time <code class="bg-gray bg-opacity-20 pl-[2px] pr-[2px] align-middle text-sm leading-none undefined">useEffect()</code> is called is after the component is mounted i.e after the DOM is created.</p>
<p>우선 아래와 같은 custom hook을 하나 만들었다.
<code class="bg-gray bg-opacity-20 pl-[2px] pr-[2px] align-middle text-sm leading-none undefined">isClient</code>는 클라이언트에서만 true이 된다.</p>
<p>I created the following custom hook first.
<code class="bg-gray bg-opacity-20 pl-[2px] pr-[2px] align-middle text-sm leading-none undefined">isClient</code> can be true only on the client.</p>
<pre><pre style="color:#d4d4d4;font-size:13px;text-shadow:none;font-family:Menlo, Monaco, Consolas, &quot;Andale Mono&quot;, &quot;Ubuntu Mono&quot;, &quot;Courier New&quot;, monospace;direction:ltr;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none;padding:1em;margin:.5em 0;overflow:auto;background:#1e1e1e"><code class="language-typescript" style="white-space:pre;color:#9cdcfe;font-size:13px;text-shadow:none;font-family:Menlo, Monaco, Consolas, &quot;Andale Mono&quot;, &quot;Ubuntu Mono&quot;, &quot;Courier New&quot;, monospace;direction:ltr;text-align:left;word-spacing:normal;word-break:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none"><span class="token" style="color:#569CD6">import</span><span> </span><span class="token" style="color:#d4d4d4">{</span><span> useEffect</span><span class="token" style="color:#d4d4d4">,</span><span> useState </span><span class="token" style="color:#d4d4d4">}</span><span> </span><span class="token" style="color:#569CD6">from</span><span> </span><span class="token" style="color:#ce9178">&quot;react&quot;</span><span class="token" style="color:#d4d4d4">;</span><span>
</span>
<span></span><span class="token" style="color:#569CD6">export</span><span> </span><span class="token" style="color:#569CD6">default</span><span> </span><span class="token" style="color:#569CD6">function</span><span> </span><span class="token" style="color:#dcdcaa">useClient</span><span class="token" style="color:#d4d4d4">(</span><span class="token" style="color:#d4d4d4">)</span><span> </span><span class="token" style="color:#d4d4d4">{</span><span>
</span><span>  </span><span class="token" style="color:#569CD6">const</span><span> </span><span class="token" style="color:#d4d4d4">[</span><span>isClient</span><span class="token" style="color:#d4d4d4">,</span><span> setClient</span><span class="token" style="color:#d4d4d4">]</span><span> </span><span class="token" style="color:#d4d4d4">=</span><span> </span><span class="token" style="color:#dcdcaa">useState</span><span class="token" style="color:#d4d4d4">(</span><span class="token" style="color:#569cd6">false</span><span class="token" style="color:#d4d4d4">)</span><span class="token" style="color:#d4d4d4">;</span><span>
</span>
<span>  </span><span class="token" style="color:#dcdcaa">useEffect</span><span class="token" style="color:#d4d4d4">(</span><span class="token" style="color:#d4d4d4">(</span><span class="token" style="color:#d4d4d4">)</span><span> </span><span class="token" style="color:#d4d4d4">=&gt;</span><span> </span><span class="token" style="color:#d4d4d4">{</span><span>
</span><span>    </span><span class="token" style="color:#dcdcaa">setClient</span><span class="token" style="color:#d4d4d4">(</span><span class="token" style="color:#569cd6">true</span><span class="token" style="color:#d4d4d4">)</span><span class="token" style="color:#d4d4d4">;</span><span>
</span><span>  </span><span class="token" style="color:#d4d4d4">}</span><span class="token" style="color:#d4d4d4">,</span><span> </span><span class="token" style="color:#d4d4d4">[</span><span class="token" style="color:#d4d4d4">]</span><span class="token" style="color:#d4d4d4">)</span><span class="token" style="color:#d4d4d4">;</span><span>
</span>
<span>  </span><span class="token" style="color:#569CD6">return</span><span> </span><span class="token" style="color:#d4d4d4">{</span><span> isClient </span><span class="token" style="color:#d4d4d4">}</span><span class="token" style="color:#d4d4d4">;</span><span>
</span><span></span><span class="token" style="color:#d4d4d4">}</span></code></pre></pre>
<p>이를 이용하여, 아래와 같이 CSR 전까지는 react-syntax-highlighter를 적용하지 않도록 하여 에러를 해결하였다.
(가독성을 위해 일부 props는 생략하였다.)</p>
<p>Using this, I solved the errors by preventing the component from applying react-syntax-highlighter before starting CSR.
(I omitted some props for readability.)</p>
<pre><pre style="color:#d4d4d4;font-size:13px;text-shadow:none;font-family:Menlo, Monaco, Consolas, &quot;Andale Mono&quot;, &quot;Ubuntu Mono&quot;, &quot;Courier New&quot;, monospace;direction:ltr;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none;padding:1em;margin:.5em 0;overflow:auto;background:#1e1e1e"><code class="language-tsx" style="white-space:pre;color:#9cdcfe;font-size:13px;text-shadow:none;font-family:Menlo, Monaco, Consolas, &quot;Andale Mono&quot;, &quot;Ubuntu Mono&quot;, &quot;Courier New&quot;, monospace;direction:ltr;text-align:left;word-spacing:normal;word-break:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none"><span class="token" style="color:#569CD6">import</span><span> </span><span class="token" style="color:#d4d4d4">{</span><span> PrismLight </span><span class="token" style="color:#569CD6">as</span><span> SyntaxHighlighter </span><span class="token" style="color:#d4d4d4">}</span><span> </span><span class="token" style="color:#569CD6">from</span><span> </span><span class="token" style="color:#ce9178">&quot;react-syntax-highlighter&quot;</span><span class="token" style="color:#d4d4d4">;</span><span>
</span>
<span></span><span class="token" style="color:#d4d4d4">...</span><span>
</span>
<span></span><span class="token" style="color:#569CD6">const</span><span> </span><span class="token function-variable" style="color:#dcdcaa">PostView</span><span> </span><span class="token" style="color:#d4d4d4">=</span><span> </span><span class="token" style="color:#d4d4d4">(</span><span class="token" style="color:#d4d4d4">)</span><span> </span><span class="token" style="color:#d4d4d4">=&gt;</span><span> </span><span class="token" style="color:#d4d4d4">(</span><span>
</span><span>  </span><span class="token" style="color:#808080">&lt;</span><span class="token" style="color:#4ec9b0">ReactMarkdown</span><span class="token" style="color:#569cd6">
</span><span class="token" style="color:#569cd6">    </span><span class="token" style="color:#9cdcfe">components</span><span class="token script language-javascript script-punctuation" style="color:#569cd6">=</span><span class="token script language-javascript" style="color:#808080">{</span><span class="token script language-javascript" style="color:#808080">{</span><span class="token script language-javascript" style="color:#569cd6">
</span><span class="token script language-javascript" style="color:#569cd6">      code</span><span class="token script language-javascript" style="color:#d4d4d4">:</span><span class="token script language-javascript" style="color:#569cd6"> MarkdownCode</span><span class="token script language-javascript" style="color:#808080">,</span><span class="token script language-javascript" style="color:#569cd6">
</span><span class="token script language-javascript" style="color:#569cd6">      a</span><span class="token script language-javascript" style="color:#d4d4d4">:</span><span class="token script language-javascript" style="color:#569cd6"> MarkdownLink</span><span class="token script language-javascript" style="color:#808080">,</span><span class="token script language-javascript" style="color:#569cd6">
</span><span class="token script language-javascript" style="color:#569cd6">      img</span><span class="token script language-javascript" style="color:#d4d4d4">:</span><span class="token script language-javascript" style="color:#569cd6"> MarkdownImage</span><span class="token script language-javascript" style="color:#808080">,</span><span class="token script language-javascript" style="color:#569cd6">
</span><span class="token script language-javascript" style="color:#569cd6">    </span><span class="token script language-javascript" style="color:#808080">}</span><span class="token script language-javascript" style="color:#808080">}</span><span class="token" style="color:#569cd6">
</span><span class="token" style="color:#569cd6">  </span><span class="token" style="color:#808080">&gt;</span><span class="token plain-text">
</span><span class="token plain-text">    ...
</span><span class="token plain-text">  </span><span class="token" style="color:#808080">&lt;/</span><span class="token" style="color:#4ec9b0">ReactMarkdown</span><span class="token" style="color:#808080">&gt;</span><span>
</span><span></span><span class="token" style="color:#d4d4d4">)</span><span class="token" style="color:#d4d4d4">;</span><span>
</span>
<span></span><span class="token" style="color:#d4d4d4">...</span><span>
</span>
<span></span><span class="token" style="color:#569CD6">const</span><span> </span><span class="token function-variable" style="color:#dcdcaa">MarkdownCode</span><span> </span><span class="token" style="color:#d4d4d4">=</span><span> </span><span class="token" style="color:#d4d4d4">(</span><span class="token" style="color:#d4d4d4">)</span><span> </span><span class="token" style="color:#d4d4d4">=&gt;</span><span> </span><span class="token" style="color:#d4d4d4">{</span><span>
</span><span>  </span><span class="token" style="color:#569CD6">const</span><span> </span><span class="token" style="color:#d4d4d4">{</span><span> isClient </span><span class="token" style="color:#d4d4d4">}</span><span> </span><span class="token" style="color:#d4d4d4">=</span><span> </span><span class="token" style="color:#dcdcaa">useClient</span><span class="token" style="color:#d4d4d4">(</span><span class="token" style="color:#d4d4d4">)</span><span class="token" style="color:#d4d4d4">;</span><span>
</span>
<span>  </span><span class="token" style="color:#d4d4d4">...</span><span>
</span>
<span>  </span><span class="token" style="color:#569CD6">return</span><span> isClient </span><span class="token" style="color:#d4d4d4">&amp;&amp;</span><span> </span><span class="token" style="color:#d4d4d4">...</span><span> </span><span class="token" style="color:#d4d4d4">?</span><span> </span><span class="token" style="color:#d4d4d4">(</span><span>
</span><span>    </span><span class="token" style="color:#808080">&lt;</span><span class="token" style="color:#4ec9b0">SyntaxHighlighter</span><span class="token" style="color:#808080">&gt;</span><span class="token plain-text">
</span><span class="token plain-text">      ...
</span><span class="token plain-text">    </span><span class="token" style="color:#808080">&lt;/</span><span class="token" style="color:#4ec9b0">SyntaxHighlighter</span><span class="token" style="color:#808080">&gt;</span><span>
</span><span>  </span><span class="token" style="color:#d4d4d4">)</span><span> </span><span class="token" style="color:#d4d4d4">:</span><span> </span><span class="token" style="color:#d4d4d4">(</span><span>
</span><span>    </span><span class="token" style="color:#808080">&lt;</span><span class="token" style="color:#4ec9b0">InlineCode</span><span class="token" style="color:#808080">&gt;</span><span class="token plain-text">
</span><span class="token plain-text">      ...
</span><span class="token plain-text">    </span><span class="token" style="color:#808080">&lt;/</span><span class="token" style="color:#4ec9b0">InlineCode</span><span class="token" style="color:#808080">&gt;</span><span>
</span><span>  </span><span class="token" style="color:#d4d4d4">)</span><span class="token" style="color:#d4d4d4">;</span><span>
</span><span></span><span class="token" style="color:#d4d4d4">}</span><span class="token" style="color:#d4d4d4">;</span></code></pre></pre></div><div class="my-4 w-full border-b-2 border-dashed border-gray"></div><div class="mb-32 mt-8 text-base">Loading the comments...</div><div id="disqus_thread"></div></div></div><div class="h-32 w-full shrink-0"></div></div><script src="/_next/static/chunks/webpack-5f8259d795d78687.js" async=""></script><script>(self.__next_f=self.__next_f||[]).push([0])</script><script>self.__next_f.push([1,"1:\"$Sreact.fragment\"\n2:I[7628,[\"177\",\"static/chunks/app/layout-5d369154124a380d.js\"],\"\"]\n3:I[9888,[],\"\"]\n4:I[9750,[],\"\"]\n6:I[977,[],\"OutletBoundary\"]\n8:I[977,[],\"MetadataBoundary\"]\na:I[977,[],\"ViewportBoundary\"]\nc:I[9375,[],\"\"]\n:HL[\"/_next/static/css/c709d57c9a965b1c.css\",\"style\"]\n"])</script><script>self.__next_f.push([1,"0:{\"P\":null,\"b\":\"Tluo48OF_fFFK-gKgpM3n\",\"p\":\"\",\"c\":[\"\",\"ko\",\"blog\",\"post\",\"nextmismatch\"],\"i\":false,\"f\":[[[\"\",{\"children\":[[\"locale\",\"ko\",\"d\"],{\"children\":[\"blog\",{\"children\":[\"post\",{\"children\":[[\"key\",\"nextmismatch\",\"d\"],{\"children\":[\"__PAGE__\",{}]}]}]}]}]},\"$undefined\",\"$undefined\",true],[\"\",[\"$\",\"$1\",\"c\",{\"children\":[[[\"$\",\"link\",\"0\",{\"rel\":\"stylesheet\",\"href\":\"/_next/static/css/c709d57c9a965b1c.css\",\"precedence\":\"next\",\"crossOrigin\":\"$undefined\",\"nonce\":\"$undefined\"}]],[\"$\",\"html\",null,{\"lang\":\"ko\",\"className\":\"m-0 h-full w-full p-0 font-sans\",\"children\":[[\"$\",\"head\",null,{\"children\":[[\"$\",\"link\",null,{\"rel\":\"stylesheet\",\"as\":\"style\",\"crossOrigin\":\"\",\"href\":\"https://cdn.jsdelivr.net/gh/orioncactus/pretendard@v1.3.9/dist/web/static/pretendard-dynamic-subset.min.css\"}],[\"$\",\"link\",null,{\"rel\":\"preconnect\",\"href\":\"https://fonts.googleapis.com\"}],[\"$\",\"link\",null,{\"rel\":\"preconnect\",\"href\":\"https://fonts.gstatic.com\",\"crossOrigin\":\"\"}],[\"$\",\"link\",null,{\"href\":\"https://fonts.googleapis.com/css2?family=Fira+Code:wght@300..700\u0026display=swap\",\"rel\":\"stylesheet\"}]]}],[\"$\",\"body\",null,{\"className\":\"m-0 h-full w-full p-0\",\"children\":[[\"$\",\"$L2\",null,{\"color\":\"#d6d6d6\",\"showSpinner\":false,\"shadow\":false}],[\"$\",\"div\",null,{\"className\":\"flex h-full w-full flex-col items-center overflow-y-auto bg-background pt-16 text-primary\",\"children\":[[\"$\",\"div\",null,{\"className\":\"w-full max-w-screen-lg px-6\",\"children\":[\"$\",\"$L3\",null,{\"parallelRouterKey\":\"children\",\"segmentPath\":[\"children\"],\"error\":\"$undefined\",\"errorStyles\":\"$undefined\",\"errorScripts\":\"$undefined\",\"template\":[\"$\",\"$L4\",null,{}],\"templateStyles\":\"$undefined\",\"templateScripts\":\"$undefined\",\"notFound\":[[],[[\"$\",\"title\",null,{\"children\":\"404: This page could not be found.\"}],[\"$\",\"div\",null,{\"style\":{\"fontFamily\":\"system-ui,\\\"Segoe UI\\\",Roboto,Helvetica,Arial,sans-serif,\\\"Apple Color Emoji\\\",\\\"Segoe UI Emoji\\\"\",\"height\":\"100vh\",\"textAlign\":\"center\",\"display\":\"flex\",\"flexDirection\":\"column\",\"alignItems\":\"center\",\"justifyContent\":\"center\"},\"children\":[\"$\",\"div\",null,{\"children\":[[\"$\",\"style\",null,{\"dangerouslySetInnerHTML\":{\"__html\":\"body{color:#000;background:#fff;margin:0}.next-error-h1{border-right:1px solid rgba(0,0,0,.3)}@media (prefers-color-scheme:dark){body{color:#fff;background:#000}.next-error-h1{border-right:1px solid rgba(255,255,255,.3)}}\"}}],[\"$\",\"h1\",null,{\"className\":\"next-error-h1\",\"style\":{\"display\":\"inline-block\",\"margin\":\"0 20px 0 0\",\"padding\":\"0 23px 0 0\",\"fontSize\":24,\"fontWeight\":500,\"verticalAlign\":\"top\",\"lineHeight\":\"49px\"},\"children\":404}],[\"$\",\"div\",null,{\"style\":{\"display\":\"inline-block\"},\"children\":[\"$\",\"h2\",null,{\"style\":{\"fontSize\":14,\"fontWeight\":400,\"lineHeight\":\"49px\",\"margin\":0},\"children\":\"This page could not be found.\"}]}]]}]}]]],\"forbidden\":\"$undefined\",\"unauthorized\":\"$undefined\"}]}],[\"$\",\"div\",null,{\"className\":\"h-32 w-full shrink-0\"}]]}]]}]]}]]}],{\"children\":[[\"locale\",\"ko\",\"d\"],[\"$\",\"$1\",\"c\",{\"children\":[null,[\"$\",\"$L3\",null,{\"parallelRouterKey\":\"children\",\"segmentPath\":[\"children\",\"$0:f:0:1:2:children:0\",\"children\"],\"error\":\"$undefined\",\"errorStyles\":\"$undefined\",\"errorScripts\":\"$undefined\",\"template\":[\"$\",\"$L4\",null,{}],\"templateStyles\":\"$undefined\",\"templateScripts\":\"$undefined\",\"notFound\":\"$undefined\",\"forbidden\":\"$undefined\",\"unauthorized\":\"$undefined\"}]]}],{\"children\":[\"blog\",[\"$\",\"$1\",\"c\",{\"children\":[null,[\"$\",\"$L3\",null,{\"parallelRouterKey\":\"children\",\"segmentPath\":[\"children\",\"$0:f:0:1:2:children:0\",\"children\",\"blog\",\"children\"],\"error\":\"$undefined\",\"errorStyles\":\"$undefined\",\"errorScripts\":\"$undefined\",\"template\":[\"$\",\"$L4\",null,{}],\"templateStyles\":\"$undefined\",\"templateScripts\":\"$undefined\",\"notFound\":\"$undefined\",\"forbidden\":\"$undefined\",\"unauthorized\":\"$undefined\"}]]}],{\"children\":[\"post\",[\"$\",\"$1\",\"c\",{\"children\":[null,[\"$\",\"$L3\",null,{\"parallelRouterKey\":\"children\",\"segmentPath\":[\"children\",\"$0:f:0:1:2:children:0\",\"children\",\"blog\",\"children\",\"post\",\"children\"],\"error\":\"$undefined\",\"errorStyles\":\"$undefined\",\"errorScripts\":\"$undefined\",\"template\":[\"$\",\"$L4\",null,{}],\"templateStyles\":\"$undefined\",\"templateScripts\":\"$undefined\",\"notFound\":\"$undefined\",\"forbidden\":\"$undefined\",\"unauthorized\":\"$undefined\"}]]}],{\"children\":[[\"key\",\"nextmismatch\",\"d\"],[\"$\",\"$1\",\"c\",{\"children\":[null,[\"$\",\"$L3\",null,{\"parallelRouterKey\":\"children\",\"segmentPath\":[\"children\",\"$0:f:0:1:2:children:0\",\"children\",\"blog\",\"children\",\"post\",\"children\",\"$0:f:0:1:2:children:2:children:2:children:2:children:0\",\"children\"],\"error\":\"$undefined\",\"errorStyles\":\"$undefined\",\"errorScripts\":\"$undefined\",\"template\":[\"$\",\"$L4\",null,{}],\"templateStyles\":\"$undefined\",\"templateScripts\":\"$undefined\",\"notFound\":\"$undefined\",\"forbidden\":\"$undefined\",\"unauthorized\":\"$undefined\"}]]}],{\"children\":[\"__PAGE__\",[\"$\",\"$1\",\"c\",{\"children\":[\"$L5\",null,[\"$\",\"$L6\",null,{\"children\":\"$L7\"}]]}],{},null,false]},null,false]},null,false]},null,false]},null,false]},null,false],[\"$\",\"$1\",\"h\",{\"children\":[null,[\"$\",\"$1\",\"AzCPWpaX1MZyDT73kcbJG\",{\"children\":[[\"$\",\"$L8\",null,{\"children\":\"$L9\"}],[\"$\",\"$La\",null,{\"children\":\"$Lb\"}],null]}]]}],false]],\"m\":\"$undefined\",\"G\":[\"$c\",\"$undefined\"],\"s\":false,\"S\":true}\n"])</script><script>self.__next_f.push([1,"d:I[1357,[\"899\",\"static/chunks/66a21e36-9320fd4f2767de8c.js\",\"79\",\"static/chunks/79-121b1482e66f2415.js\",\"568\",\"static/chunks/568-94d199cce9c2ce6e.js\",\"253\",\"static/chunks/app/%5Blocale%5D/blog/post/%5Bkey%5D/page-39ba752fa4b62049.js\"],\"default\"]\ne:I[149,[\"899\",\"static/chunks/66a21e36-9320fd4f2767de8c.js\",\"79\",\"static/chunks/79-121b1482e66f2415.js\",\"568\",\"static/chunks/568-94d199cce9c2ce6e.js\",\"253\",\"static/chunks/app/%5Blocale%5D/blog/post/%5Bkey%5D/page-39ba752fa4b62049.js\"],\"default\"]\n10:I[6879,[\"899\",\"static/chunks/66a21e36-9320fd4f2767de8c.js\",\"79\",\"static/chunks/79-121b1482e66f2415.js\",\"568\",\"static/chunks/568-94d199cce9c2ce6e.js\",\"253\",\"static/chunks/app/%5Blocale%5D/blog/post/%5Bkey%5D/page-39ba752fa4b62049.js\"],\"default\"]\nf:T1df5,"])</script><script>self.__next_f.push([1,"이 웹사이트를 실행했을 때, 작동은 잘 되는 것 같은데 콘솔에 아래와 같은 에러 메시지들이 뜨는 문제가 있었다.\n\nWhen I run this website, it seems to work fine, but I got following error messages appearing on the console.\n\n```text\nUncaught Error: Minified React error #425; visit https://reactjs.org/docs/error-decoder.html?invariant=425 for the full message or use the non-minified dev environment for full errors and additional helpful warnings.\n\nUncaught Error: Minified React error #418; visit https://reactjs.org/docs/error-decoder.html?invariant=418 for the full message or use the non-minified dev environment for full errors and additional helpful warnings.\n\nUncaught Error: Minified React error #423; visit https://reactjs.org/docs/error-decoder.html?invariant=423 for the full message or use the non-minified dev environment for full errors and additional helpful warnings.\n```\n\n위 에러 메시지들에 나온 링크를 방문해보면 아래와 같은 메시지들이 나온다.\n\nIf you visit the links in these error messages, you will see the following messages.\n\n- Text content does not match server-rendered HTML.\n- Hydration failed because the initial UI does not match what was rendered on the server.\n- There was an error while hydrating. Because the error happened outside of a Suspense boundary, the entire root will switch to client rendering.\n\n이 웹사이트는 Next.js로 정적 사이트 생성(SSG - Static Site Generation)을 하여 만들었다.\nNext.js로 미리 생성한 HTML을 일단 유저에게 보여주고, 그 후에 React로 hydration \u0026 CSR(Client-side Rendering)을 하는 방식이다.\n따라서, 위의 메시지들은 미리 렌더링한 HTML과 클라이언트에서 렌더링한 HTML 간에 내용물이 불일치한다는 것을 의미한다.\n이 문제는 SSR 뿐만 아니라 SSR 상황에서도 동일하게 발생한다.\n\nI created this website by using SSG (Static Site Generation) with Next.js\nIt works by showing the pre-generated HTML to the user first, and performing hydration \u0026 CSR (Client-side Rendering) with React.\nTherefore, the above messages mean that there is a content mismatch between the pre-rendered HTML and the client-rendered HTML.\nThis problem can occur not only SSG but also SSR, too.\n\n원인은 두 곳에 있었다.\n하나는 페이지 상단의 시계 UI이다.\n\nThere were two reasons.\nOne is the clock UI at the top of the page.\n\n```typescript\nimport { useEffect, useState } from \"react\";\n\nexport default function useNow() {\n  const [now, setNow] = useState(new Date());\n\n  useEffect(() =\u003e {\n    const interval = setInterval(() =\u003e {\n      setNow(new Date());\n    }, 1000 * 10);\n\n    return () =\u003e {\n      clearInterval(interval);\n    };\n  }, []);\n\n  return {\n    year: now.getFullYear(),\n    month: now.getMonth() + 1,\n    monthDay: now.getDate(),\n    hour: now.getHours(),\n    minute: now.getMinutes(),\n    second: now.getSeconds(),\n  };\n}\n```\n\n시계 기능을 구현하기 위해 위와 같은 custom hook을 작성했었다.\n그런데 `const [now, setNow] = useState(new Date());`에서 `new Date()`의 값은 서버 렌더링 시와, 클라이언트 렌더링 시에 **서로 다르다**.\n이로 인하여 시계 텍스트가 두 상황에서 불일치하여 에러가 났던 것이다.\nCSR 전까지는 실제 시간을 사용하지 않고 더미 값을 쓰도록 하여 해결하였다.\n\nI wrote the above custom hook to implement the clock.\nHowever, in `const [now, setNow] = useState(new Date());`, the value of `new Date()` is **different** between server rendering and client rendering.\nThis inconsistency of the clock text caused the error.\nI solved this problem by using a dummy value until we perform CSR.\n\n다만 이러면 초반에 시간이 더미 값으로 떠서 이상해 보이는 문제가 있다.\n적절한 로딩 UI를 부여하면 좀 낫지 않을까 한다.\n\nHowever, we get a problem that the user sees a dummy value at the beginning.\nWe may fix that problem by using appropriate loading UI.\n\n```typescript\nimport { useEffect, useState } from \"react\";\n\ninterface Time {\n  year: number;\n  month: number;\n  monthDay: number;\n  hour: number;\n  minute: number;\n  second: number;\n}\n\nexport default function useNow(): Time {\n  // If we use new Date() at here, server HTML and client HTML won't match.\n  // So we don't compute date before useEffect().\n  const [now, setNow] = useState\u003cDate | null\u003e(null);\n\n  useEffect(() =\u003e {\n    setNow(new Date());\n\n    const interval = setInterval(() =\u003e {\n      setNow(new Date());\n    }, 1000 * 10);\n\n    return () =\u003e {\n      clearInterval(interval);\n    };\n  }, []);\n\n  return now === null\n    ? {\n        year: 0,\n        month: 0,\n        monthDay: 0,\n        hour: 0,\n        minute: 0,\n        second: 0,\n      }\n    : {\n        year: now.getFullYear(),\n        month: now.getMonth() + 1,\n        monthDay: now.getDate(),\n        hour: now.getHours(),\n        minute: now.getMinutes(),\n        second: now.getSeconds(),\n      };\n}\n```\n\n다른 하나는 이 글처럼 코드를 렌더링 할 때 쓰는 react-syntax-highlighter 라이브러리이다.\n해당 라이브러리는 내부적으로 [Prism.js](https://prismjs.com/)(또는 [highlight.js](https://highlightjs.org/))를 호출한다.\n이들은 코드를 읽고 **DOM을 변경**하여 코드 하이라이팅을 한다.\n이것이 mismatch를 만들어낸 것으로 추정한다.\n\n이와 같은 상황에서 특정 동작을 클라이언트에서만 하도록 하고 싶으면, `useEffect()`를 활용할 수 있다.\n`useEffect()` 안의 코드는 항상 **클라이언트에서만 실행**된다.\n`useEffect()`가 처음 불리는 시점은 컴포넌트가 마운트된 이후, 즉 DOM이 생성된 이후이기 때문이다.\n\nThe other is the react-syntax-highlighter library used when rendering code like this article.\nThe library calls [Prism.js](https://prismjs.com/) (or [highlight.js](https://highlightjs.org/)) internally.\nThey read the code and **change the DOM** to highlight the code.\nIt seems that that behavior created mismatches.\n\nIn such a situation, if you want to make certain actions executed only for the client, you can use `useEffect()`.\nCode in `useEffect()` is always executed **only on the client**.\nThis is because the first time `useEffect()` is called is after the component is mounted i.e after the DOM is created.\n\n우선 아래와 같은 custom hook을 하나 만들었다.\n`isClient`는 클라이언트에서만 true이 된다.\n\nI created the following custom hook first.\n`isClient` can be true only on the client.\n\n```typescript\nimport { useEffect, useState } from \"react\";\n\nexport default function useClient() {\n  const [isClient, setClient] = useState(false);\n\n  useEffect(() =\u003e {\n    setClient(true);\n  }, []);\n\n  return { isClient };\n}\n```\n\n이를 이용하여, 아래와 같이 CSR 전까지는 react-syntax-highlighter를 적용하지 않도록 하여 에러를 해결하였다.\n(가독성을 위해 일부 props는 생략하였다.)\n\nUsing this, I solved the errors by preventing the component from applying react-syntax-highlighter before starting CSR.\n(I omitted some props for readability.)\n\n```tsx\nimport { PrismLight as SyntaxHighlighter } from \"react-syntax-highlighter\";\n\n...\n\nconst PostView = () =\u003e (\n  \u003cReactMarkdown\n    components={{\n      code: MarkdownCode,\n      a: MarkdownLink,\n      img: MarkdownImage,\n    }}\n  \u003e\n    ...\n  \u003c/ReactMarkdown\u003e\n);\n\n...\n\nconst MarkdownCode = () =\u003e {\n  const { isClient } = useClient();\n\n  ...\n\n  return isClient \u0026\u0026 ... ? (\n    \u003cSyntaxHighlighter\u003e\n      ...\n    \u003c/SyntaxHighlighter\u003e\n  ) : (\n    \u003cInlineCode\u003e\n      ...\n    \u003c/InlineCode\u003e\n  );\n};\n```\n"])</script><script>self.__next_f.push([1,"5:[\"$\",\"div\",null,{\"className\":\"w-full\",\"children\":[[\"$\",\"header\",null,{\"className\":\"mb-4 flex w-full flex-row items-center\",\"children\":[[\"$\",\"h1\",null,{\"className\":\"m-0 mr-auto p-0 font-mono text-3xl font-normal md:text-4xl\",\"children\":\"Blog\"}],[\"$\",\"$Ld\",null,{}]]}],[\"$\",\"div\",null,{\"className\":\"mb-4 w-full border-b-2 border-dashed border-gray pb-4\",\"children\":[[\"$\",\"h2\",null,{\"className\":\"m-0 p-0 text-xl\",\"children\":\"Server \u0026 client mismatch problem in Next.js\"}],[\"$\",\"div\",null,{\"className\":\"text-gray\",\"children\":\"2022-09-21\"}]]}],[\"$\",\"$Le\",null,{\"post\":{\"key\":\"nextmismatch\",\"title\":\"Server \u0026 client mismatch problem in Next.js\",\"time\":1663718400000,\"category\":\"Computer\",\"content\":\"$f\"}}],[\"$\",\"div\",null,{\"className\":\"my-4 w-full border-b-2 border-dashed border-gray\"}],[\"$\",\"$L10\",null,{\"shortname\":\"Avantgarde95\",\"config\":{\"url\":\"https://avantgarde95.github.io/blog/nextmismatch\",\"identifier\":\"Server \u0026 client mismatch problem in Next.js\",\"title\":\"Server \u0026 client mismatch problem in Next.js\"}}]]}]\n"])</script><script>self.__next_f.push([1,"b:[[\"$\",\"meta\",\"0\",{\"name\":\"viewport\",\"content\":\"width=device-width, initial-scale=1\"}]]\n"])</script><script>self.__next_f.push([1,"9:[[\"$\",\"meta\",\"0\",{\"charSet\":\"utf-8\"}],[\"$\",\"title\",\"1\",{\"children\":\"Server \u0026 client mismatch problem in Next.js\"}]]\n"])</script><script>self.__next_f.push([1,"7:null\n"])</script></body></html>